# workflow 의 이름
name: Run Test

on:
  push:
    tags:
      - "v*"

# workflow의 실행은 하나 이상의 job으로 구성 됨
jobs:
  build-and-test:

    runs-on: self-hosted
    env:
      XCWORKSPACE: MyApp.xcworkspace
      PROJECT: MyApp.xcodeproj
      SCHEME: Model
      CONFIGURATION: Debug
      DESTINATION: platform=iOS Simulator,name=iPad Pro (9.7-inch),OS=latest
      
    steps:
    # step 1
    - name: Checkout source code
      uses: actions/checkout@v2
    
    # step 2
    - name: CocoaPod Install
      run: pod install
      
    # step 3
    - name: Select Xcode
      run: sudo xcode-select -switch /Applications/Xcode.app

    # step 4
    - name: Build and Test
      run: xcodebuild clean build test
           -workspace "$XCWORKSPACE" 
           -scheme "$SCHEME"
           -configuration "$CONFIGURATION" 
           -destination "$DESTINATION" 
           -enableCodeCoverage YES | xcpretty --color
